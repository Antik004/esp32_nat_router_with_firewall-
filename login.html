<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center; }
      body { background-color: #f0f0f0; padding: 20px; }
      .login-container { background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 400px; margin: 50px auto; }
      h2 { color: #333; }
      .form-group { margin: 20px 0; text-align: left; }
      label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
      input[type=text], input[type=password], input[type=tel] { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
      input[type=text]:focus, input[type=password]:focus, input[type=tel]:focus { outline: none; border-color: #4CAF50; }
      .button { background-color: #4CAF50; border: none; color: white; padding: 12px 40px; text-decoration: none; font-size: 16px; margin: 10px 0; cursor: pointer; border-radius: 4px; width: 100%; }
      .button:hover { background-color: #45a049; }
      .verify-button { background-color: #2196F3; }
      .verify-button:hover { background-color: #0b7dda; }
      .mobile-container { display: flex; gap: 10px; align-items: center; }
      .mobile-input { flex: 1; }
      .mobile-verify-btn { width: 120px; padding: 12px; margin: 0; }
      .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
      .modal-content { background-color: #fefefe; margin: 10% auto; padding: 30px; border: 1px solid #888; border-radius: 8px; width: 90%; max-width: 400px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
      .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
      .close-btn:hover { color: #000; }
      .modal h3 { color: #333; margin-top: 0; }
      .code-input { font-size: 24px; text-align: center; letter-spacing: 10px; }
      .modal-button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; width: 100%; }
      .modal-button:hover { background-color: #45a049; }
      .cancel-button { background-color: #f44336; margin-top: 10px; }
      .cancel-button:hover { background-color: #da190b; }
    </style>
  </head>
  <body>
    <div class="login-container">
      <h2>ESP32 Firewall Login</h2>
      <form action="/adminlogin" method="POST" id="loginForm">
        <div class="form-group">
          <label for="username">Username:</label>
          <input type="text" id="username" name="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" placeholder="Enter password" required>
        </div>
        <div class="form-group">
          <label for="mobile">Mobile Number:</label>
          <div class="mobile-container">
            <input type="tel" id="mobile" name="mobile" class="mobile-input" placeholder="Enter mobile number" pattern="[0-9]{10}" required>
            <button class="button verify-button mobile-verify-btn" type="button" onclick="requestMobileVerification()">Verify</button>
          </div>
        </div>
        
        <button class="button" type="submit">Login</button>
      </form>
    </div>

    <!-- Mobile Verification Code Modal -->
    <div id="codeModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeCodeModal()">&times;</span>
        <h3>Enter Verification Code</h3>
        <p>Verification code has been sent to your mobile number via SMS</p>
        <div class="form-group">
          <label for="code_modal">Code:</label>
          <input type="text" id="code_modal" class="code-input" placeholder="000000" maxlength="6" required>
        </div>
        <button class="modal-button" type="button" onclick="verifyCode()">Verify Code</button>
        <button class="modal-button cancel-button" type="button" onclick="closeCodeModal()">Cancel</button>
      </div>
    </div>

    <script>
      function requestMobileVerification() {
        var mobile = document.getElementById("mobile").value;
        if (mobile.length === 10) {
          document.getElementById("codeModal").style.display = "block";
        } else {
          alert("Please enter a valid 10-digit mobile number");
        }
      }

      function closeCodeModal() {
        document.getElementById("codeModal").style.display = "none";
        document.getElementById("code_modal").value = "";
      }

      function verifyCode() {
        var code = document.getElementById("code_modal").value;
        var mobile = document.getElementById("mobile").value;
        if (code.length === 6) {
          fetch('/verify_code', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'mobile=' + mobile + '&code=' + code
          })
          .then(response => response.text())
          .then(data => {
            alert("Code Verified Successfully!");
            document.getElementById("verification_code_input").value = code;
            closeCodeModal();
          })
          .catch(error => alert("Verification failed: " + error));
        } else {
          alert("Please enter a valid 6-digit code");
        }
      }

      window.onclick = function(event) {
        var codeModal = document.getElementById("codeModal");
        if (event.target == codeModal) {
          codeModal.style.display = "none";
        }
      }
    </script>
  </body>
</html>